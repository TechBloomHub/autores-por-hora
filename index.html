<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fotografías de Autores por Hora</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    h1 { text-align: center; margin-bottom: 40px; }
    section { margin-bottom: 60px; }
    h2 { border-bottom: 2px solid #333; padding-bottom: 8px; margin-bottom: 20px; color: #333; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
    .card { background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow: hidden; text-align: center; }
    .card img { width: 100%; height: auto; display: block; }
    .caption { padding: 10px; font-size: 14px; color: #555; }
  </style>
</head>
<body>
  <h1>Fotografías de los Autores Ordenadas por Hora</h1>
  <div id="schedule"></div>
  <script>
    const schedule = {
      "10:00 – 11:00": ["David Uclés", "Roc Casagran"],
      "11:00 – 12:00": [
        "Alice Kellen", "Inma Rubiales", "Dr. Manel Sans Segarra", "Juan Carlos Cebrián", "72 Kilos", "Borja Vilaseca",
        "Jaime Palomera", "Mara Torres", "Silvia Intxaurrondo", "Paloma San Basilio", "Alejandro Palomas",
        "Pedro Piqueras", "Tomás Páramo", "Carlos del Amor", "Carmen Mola", "Laura Fa", "Marta Pontnou",
        "Jordi Sierra i Fabra", "Najat el Hachmi"
      ],
      "12:00 – 13:00": [
        "Alice Kellen", "Inma Rubiales", "Dr. Manel Sans Segarra", "Juan Carlos Cebrián", "Ángel Martín", "72 Kilos",
        "El Monaguillo", "Mara Torres", "Joana Cabratosa / Ona Jou / Núria Simon", "Joaquim Bosch",
        "Pedro Baños", "Roberto Brasero", "Julia Navarro", "Alana S. Portero", "Manuela Carmena",
        "Mikel L. Iturriaga", "Bárbara Montes", "Jordi y Martí Roca", "Cristina Pedroche"
      ],
      "13:00 – 14:00": [
        "Alice Kellen", "Inma Rubiales", "Josep Vicent Frechina", "Ángel Martín", "Xavier Guix", "Natacha Alfageme",
        "El Monaguillo", "Alejandro G. Calvo", "Joana Cabratosa / Ona Jou / Núria Simon", "Miguel Ángel Revilla",
        "Juan Trejo", "Manel Vidal Boix", "Beatriz Serrano", "Paloma Sánchez Garnica",
        "Defreds", "Pierre Lemaitre", "Pablo d'Ors", "Toni Aira", "Cristina Pedroche"
      ],
      "16:00 – 17:00": [
        "Núria Pradas", "Andrea Longarela", "Laia Perearnau", "Javier Peña", "Miguel Noguera", "Isabel Rojas",
        "Peyu / R. Peregrina", "Jorge Díaz", "Dolores Redondo", "Santiago Díaz", "3XL Vibes",
        "Ester Invernon", "Ramon Gener", "Jair Domínguez", "Martí Gironell", "Xavier Pla",
        "Pedro Mañas", "David Sierra"
      ],
      "17:00 – 18:00": [
        "Javier Castillo", "Blue Jeans", "Andrea Longarela", "Elisabet Benavent", "Fernando Navarro (Supersubmarina)",
        "Toni Acosta", "Nina", "Lola Vendetta", "Eva G. Sáenz de Urturi", "Dolores Redondo",
        "Fer Rivas", "Carlos Esquembre", "Luna Javierre", "Inma Chacón", "Ana Oncina",
        "Julián Casanova", "Francesc Serés", "Pedro Mañas", "David Sierra"
      ],
      "18:00 – 19:00": [
        "Javier Castillo", "Blue Jeans", "Elisabet Benavent", "Carolina Iglesias", "Fernando Navarro (Supersubmarina)",
        "Toni Acosta", "María Oruña", "Elena Montagud", "Eva G. Sáenz de Urturi", "Francesca Giannone",
        "Alba Cardalda", "Doctor Aldo", "Luna Javierre", "Ildefonso Falcones", "Teresa Valero",
        "Sara García Alonso", "Marius Serra"
      ],
      "19:00 – 20:00": [
        "Javier Castillo", "Blue Jeans", "Zahara", "Elisabet Benavent", "Carolina Iglesias", "Noemí Casquet",
        "Enric Pardo", "María Oruña", "Elena Montagud", "Tània Juste", "Alejandra G. Remón",
        "Alba Cardalda", "Amaia Arrazola", "Laia López", "Ildefonso Falcones",
        "Marta Salicrú", "Ramon Solsona", "Rodrigo Cortés"
      ]
    };

    const placeholder = 'https://via.placeholder.com/300x300?text=No+imagen';

    // Genera slug para fallback de placeholder
    function slug(text) {
      return text.toLowerCase().normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
    }

    // Busca primero título con API de búsqueda, luego extrae miniatura
    async function fetchImage(author) {
      let title = author;
      // Primera búsqueda para encontrar título exacto
      try {
        const searchUrl = `https://es.wikipedia.org/w/api.php?origin=*&action=query&list=search&srsearch=${encodeURIComponent(author)}&format=json`;
        const searchRes = await fetch(searchUrl);
        const searchData = await searchRes.json();
        const hits = searchData.query.search;
        if (hits && hits.length) {
          title = hits[0].title;
        }
      } catch (e) {
        console.warn('Search failed for', author, e);
      }
      // Consulta miniatura
      try {
        const imgUrl = `https://es.wikipedia.org/w/api.php?origin=*&action=query&titles=${encodeURIComponent(title)}&prop=pageimages&format=json&pithumbsize=300`;
        const imgRes = await fetch(imgUrl);
        const imgData = await imgRes.json();
        const pages = imgData.query.pages;
        const page = Object.values(pages)[0];
        if (page && page.thumbnail && page.thumbnail.source) {
          return page.thumbnail.source;
        }
      } catch (e) {
        console.warn('Image fetch failed for', title, e);
      }
      // fallback con texto
      return `https://via.placeholder.com/300x300?text=${slug(author)}`;
    }

    // Construye la galería dinámica
    const container = document.getElementById('schedule');
    Object.entries(schedule).forEach(([time, authors]) => {
      const section = document.createElement('section');
      section.innerHTML = `<h2>${time}</h2>`;
      const gallery = document.createElement('div'); gallery.className = 'gallery';
      authors.forEach(author => {
        const card = document.createElement('div'); card.className = 'card';
        const img = document.createElement('img'); img.alt = author;
        fetchImage(author).then(src => img.src = src);
        const caption = document.createElement('div'); caption.className = 'caption'; caption.textContent = author;
        card.append(img, caption);
        gallery.appendChild(card);
      });
      section.appendChild(gallery);
      container.appendChild(section);
    });
  </script>
</body>
</html>
